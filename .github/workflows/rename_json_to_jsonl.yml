name: One-time JSON to JSONL Rename

on:
  workflow_dispatch:  # Manual trigger only
    inputs:
      dry_run:
        description: 'Run in dry-run mode (no actual changes)'
        required: false
        default: 'true'
        type: choice
        options:
        - 'true'
        - 'false'

jobs:
  rename-files:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
    
    - name: Install dependencies
      run: |
        pip install huggingface-hub
    
    - name: Run JSON to JSONL rename script
      env:
        HF_TOKEN: ${{ secrets.HF_TOKEN }}
      run: |
        echo "üöÄ Starting JSON to JSONL rename operation..."
        if [ "${{ github.event.inputs.dry_run }}" = "true" ]; then
          echo "üîç Running in DRY-RUN mode..."
          python scripts/rename_json_to_jsonl.py --repo-id evaleval/every_eval_ever --dry-run
        else
          echo "‚ö° Running in LIVE mode..."
          python scripts/rename_json_to_jsonl.py --repo-id evaleval/every_eval_ever
        fi
    
    - name: Summary
      run: |
        echo "üéâ JSON to JSONL rename operation completed!"
        echo "‚úÖ All .json files have been renamed to .jsonl"
        echo "‚úÖ HuggingFace datasets will now properly detect JSONL format"
        echo "‚úÖ Statistics generation should work correctly"
        echo ""
        echo "üìã Next steps:"
        echo "1. Clear HuggingFace datasets cache if needed"
        echo "2. Run statistics generation to verify it works"
        echo "3. This workflow can be deleted after successful verification"
